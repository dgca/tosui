# Plan: Modal Component

## Objective

Create a Modal component with portal rendering, backdrop, focus trapping, and accessibility support.

## Tasks

### Task 1: Create Modal Component

Create `packages/react/src/components/Modal/`:

**Modal.tsx:**
```tsx
import { type ReactNode, useEffect, useRef, useCallback } from "react";
import { createPortal } from "react-dom";
import clsx from "clsx";
import { Box } from "@/components/Box/Box";
import styles from "./modal.module.css";

export type ModalSize = "sm" | "md" | "lg" | "xl" | "full";

export type ModalProps = {
  /** Whether modal is open */
  isOpen: boolean;
  /** Callback when modal should close */
  onClose: () => void;
  /** Modal size */
  size?: ModalSize;
  /** Close on backdrop click */
  closeOnOverlayClick?: boolean;
  /** Close on Escape key */
  closeOnEsc?: boolean;
  /** Additional class name */
  className?: string;
  /** Modal content */
  children?: ReactNode;
};

export type ModalHeaderProps = {
  className?: string;
  children?: ReactNode;
};

export type ModalBodyProps = {
  className?: string;
  children?: ReactNode;
};

export type ModalFooterProps = {
  className?: string;
  children?: ReactNode;
};

const sizeConfig = {
  sm: "400px",
  md: "500px",
  lg: "700px",
  xl: "900px",
  full: "100%",
} as const;

export function Modal({
  isOpen,
  onClose,
  size = "md",
  closeOnOverlayClick = true,
  closeOnEsc = true,
  className,
  children,
}: ModalProps) {
  const modalRef = useRef<HTMLDivElement>(null);
  const previousFocusRef = useRef<HTMLElement | null>(null);

  // Store previous focus and trap focus in modal
  useEffect(() => {
    if (isOpen) {
      previousFocusRef.current = document.activeElement as HTMLElement;
      modalRef.current?.focus();
    } else if (previousFocusRef.current) {
      previousFocusRef.current.focus();
    }
  }, [isOpen]);

  // Handle Escape key
  useEffect(() => {
    if (!isOpen || !closeOnEsc) return;

    const handleKeyDown = (e: KeyboardEvent) => {
      if (e.key === "Escape") onClose();
    };

    document.addEventListener("keydown", handleKeyDown);
    return () => document.removeEventListener("keydown", handleKeyDown);
  }, [isOpen, closeOnEsc, onClose]);

  // Prevent body scroll when modal is open
  useEffect(() => {
    if (isOpen) {
      document.body.style.overflow = "hidden";
    } else {
      document.body.style.overflow = "";
    }
    return () => { document.body.style.overflow = ""; };
  }, [isOpen]);

  const handleOverlayClick = useCallback((e: React.MouseEvent) => {
    if (closeOnOverlayClick && e.target === e.currentTarget) {
      onClose();
    }
  }, [closeOnOverlayClick, onClose]);

  if (!isOpen) return null;

  return createPortal(
    <Box
      className={clsx(styles.overlay, className)}
      onClick={handleOverlayClick}
      role="dialog"
      aria-modal="true"
    >
      <Box
        ref={modalRef}
        tabIndex={-1}
        bg="surface"
        rounded={size === "full" ? "none" : "lg"}
        shadow="lg"
        maxH={size === "full" ? "100vh" : "90vh"}
        overflow="auto"
        className={styles.modal}
        style={{ width: sizeConfig[size], maxWidth: size === "full" ? "100%" : "calc(100% - 2rem)" }}
      >
        {children}
      </Box>
    </Box>,
    document.body
  );
}

export function ModalHeader({ className, children }: ModalHeaderProps) {
  return (
    <Box
      px={6}
      py={4}
      borderBottom="thin"
      borderColor="border"
      className={clsx(styles.header, className)}
    >
      {children}
    </Box>
  );
}

export function ModalBody({ className, children }: ModalBodyProps) {
  return (
    <Box px={6} py={4} className={clsx(styles.body, className)}>
      {children}
    </Box>
  );
}

export function ModalFooter({ className, children }: ModalFooterProps) {
  return (
    <Box
      px={6}
      py={4}
      borderTop="thin"
      borderColor="border"
      display="flex"
      justifyContent="flex-end"
      gap={2}
      className={clsx(styles.footer, className)}
    >
      {children}
    </Box>
  );
}
```

**modal.module.css:**
```css
.overlay {
  position: fixed;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  background-color: rgba(0, 0, 0, 0.5);
  z-index: var(--t-z-index-modal);
  padding: 1rem;
}

.modal {
  outline: none;
}

.header {
  /* Header styles */
}

.body {
  /* Body styles */
}

.footer {
  /* Footer styles */
}
```

**index.tsx:**
```tsx
export { Modal, ModalHeader, ModalBody, ModalFooter } from "./Modal";
export type {
  ModalSize,
  ModalProps,
  ModalHeaderProps,
  ModalBodyProps,
  ModalFooterProps,
} from "./Modal";
```

### Task 2: Export Modal and Verify Build

1. Add exports to `packages/react/src/index.tsx`
2. Run build to verify

## Verification

- [ ] Modal renders via portal
- [ ] Backdrop click closes modal
- [ ] Escape key closes modal
- [ ] Body scroll prevented when open
- [ ] Focus returns after close
- [ ] Multiple sizes work
- [ ] Build passes

## Output

- `packages/react/src/components/Modal/Modal.tsx`
- `packages/react/src/components/Modal/modal.module.css`
- `packages/react/src/components/Modal/index.tsx`
