# Plan: Menu Component

## Objective

Create Menu, MenuButton, MenuList, and MenuItem components for dropdown menus.

## Tasks

### Task 1: Create Menu Components

Create `packages/react/src/components/Menu/`:

**Menu.tsx:**
```tsx
import { type ReactNode, createContext, useContext, useState, useRef, useEffect } from "react";
import clsx from "clsx";
import { Box } from "@/components/Box/Box";
import { Button, type ButtonProps } from "@/components/Button";
import styles from "./menu.module.css";

// Context
type MenuContextValue = {
  isOpen: boolean;
  setIsOpen: (open: boolean) => void;
  buttonRef: React.RefObject<HTMLButtonElement>;
};

const MenuContext = createContext<MenuContextValue | null>(null);

function useMenuContext() {
  const context = useContext(MenuContext);
  if (!context) throw new Error("Menu components must be used within Menu");
  return context;
}

// Types
export type MenuProps = {
  /** Additional class name */
  className?: string;
  /** Menu components */
  children?: ReactNode;
};

export type MenuButtonProps = Omit<ButtonProps<"button">, "as"> & {
  /** Button content */
  children?: ReactNode;
};

export type MenuListProps = {
  /** Additional class name */
  className?: string;
  /** Menu items */
  children?: ReactNode;
};

export type MenuItemProps = {
  /** Click handler */
  onClick?: () => void;
  /** Disabled state */
  disabled?: boolean;
  /** Additional class name */
  className?: string;
  /** Item content */
  children?: ReactNode;
};

// Menu container
export function Menu({ className, children }: MenuProps) {
  const [isOpen, setIsOpen] = useState(false);
  const buttonRef = useRef<HTMLButtonElement>(null);

  // Close on outside click
  useEffect(() => {
    if (!isOpen) return;

    const handleClick = (e: MouseEvent) => {
      if (buttonRef.current?.contains(e.target as Node)) return;
      setIsOpen(false);
    };

    document.addEventListener("click", handleClick);
    return () => document.removeEventListener("click", handleClick);
  }, [isOpen]);

  // Close on Escape
  useEffect(() => {
    if (!isOpen) return;

    const handleKeyDown = (e: KeyboardEvent) => {
      if (e.key === "Escape") setIsOpen(false);
    };

    document.addEventListener("keydown", handleKeyDown);
    return () => document.removeEventListener("keydown", handleKeyDown);
  }, [isOpen]);

  return (
    <MenuContext.Provider value={{ isOpen, setIsOpen, buttonRef }}>
      <Box position="relative" display="inline-block" className={clsx(styles.menu, className)}>
        {children}
      </Box>
    </MenuContext.Provider>
  );
}

// MenuButton - trigger button
export function MenuButton({ children, className, ...rest }: MenuButtonProps) {
  const { isOpen, setIsOpen, buttonRef } = useMenuContext();

  return (
    <Button
      ref={buttonRef}
      aria-haspopup="menu"
      aria-expanded={isOpen}
      onClick={() => setIsOpen(!isOpen)}
      className={className}
      {...rest}
    >
      {children}
    </Button>
  );
}

// MenuList - dropdown container
export function MenuList({ className, children }: MenuListProps) {
  const { isOpen } = useMenuContext();

  if (!isOpen) return null;

  return (
    <Box
      role="menu"
      position="absolute"
      top="100%"
      left={0}
      mt={1}
      py={1}
      minW="160px"
      bg="surface"
      border="thin"
      borderColor="border"
      rounded="md"
      shadow="md"
      zIndex={50}
      className={clsx(styles.menuList, className)}
    >
      {children}
    </Box>
  );
}

// MenuItem - individual menu item
export function MenuItem({ onClick, disabled = false, className, children }: MenuItemProps) {
  const { setIsOpen } = useMenuContext();

  const handleClick = () => {
    if (disabled) return;
    onClick?.();
    setIsOpen(false);
  };

  return (
    <Box
      as="button"
      type="button"
      role="menuitem"
      onClick={handleClick}
      disabled={disabled}
      display="flex"
      alignItems="center"
      w="100%"
      py={2}
      px={3}
      fontSize="sm"
      color={disabled ? "foreground-muted" : "foreground"}
      bg="transparent"
      border="none"
      cursor={disabled ? "not-allowed" : "pointer"}
      textAlign="left"
      className={clsx(styles.menuItem, disabled && styles.disabled, className)}
    >
      {children}
    </Box>
  );
}
```

**menu.module.css:**
```css
.menu {
  /* Container */
}

.menuList {
  /* Dropdown animation could go here */
}

.menuItem {
  transition: background-color 0.15s ease;
}

.menuItem:hover:not(:disabled) {
  background-color: var(--t-color-surface-hover, rgba(0, 0, 0, 0.05));
}

.menuItem:focus {
  outline: none;
  background-color: var(--t-color-surface-hover, rgba(0, 0, 0, 0.05));
}

.menuItem.disabled {
  opacity: 0.5;
}
```

**index.tsx:**
```tsx
export { Menu, MenuButton, MenuList, MenuItem } from "./Menu";
export type { MenuProps, MenuButtonProps, MenuListProps, MenuItemProps } from "./Menu";
```

### Task 2: Export Menu and Verify Build

1. Add exports to `packages/react/src/index.tsx`
2. Run build to verify

## Verification

- [ ] Menu opens on button click
- [ ] Menu closes on outside click
- [ ] Menu closes on Escape key
- [ ] Menu closes when item is clicked
- [ ] Disabled items cannot be clicked
- [ ] Proper ARIA attributes
- [ ] Build passes

## Output

- `packages/react/src/components/Menu/Menu.tsx`
- `packages/react/src/components/Menu/menu.module.css`
- `packages/react/src/components/Menu/index.tsx`
